<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Countdown Timer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: sans-serif;
      text-align: center;
      margin: 0 auto;
    }
    #timer {
      font-size: 48px;
    }
    .content-container {
      display: flex;
      border: 1px solid blue;
    }
    .content-section {
      border: 1px solid green;
      min-height: 100px;
    }
    #timer-container {
      width: 40%;
    }
    #todo-container {
      width: 60%;
    }
    .content-section > div {
      border: 1px solid black;
      display: flex;
      flex-direction: column;
      padding: 10px;
    }
    #timer-select {
      margin-left: 5px;
    }
    .timer-controls {
      width: 100%;
      margin-top: 10px;
    }
    button {
      padding: 10px;
      width: 25%;
      margin: 5px;
    }
    ul {
      list-style: none;
      padding: 0;
    }
  </style>
</head>
<body>
  <h1>Pomodoro</h1>
  <div class="content-container">
    <div id="timer-container" class="content-section">
      <div id="timer">
        <select id="timer-select">
          <option value="5">5 Minutes</option>
          <option value="10">10 Minutes</option>
          <option value="custom">Custom</option>
        </select>
        <span id="timer-counter">5:00</span>
        <div class="timer-controls">
          <button id="start-btn" onclick="start_timer()">Start</button>
          <button>Pause</button>
          <button>Reset</button>
        </div>
      </div>
      <div id="instructions">
        <p>
          Lots of instructions here. Many more instructions. All the instructions.
          Lorem ipsum, etc. Lorem ipsum, etc. Lorem ipsum, etc. (Consider replacing
          this filler text with real guidance or helpful instructions.)
        </p>
      </div>
    </div>
    <div id="todo-container" class="content-section">
      <div>
        <span>ToDo</span>
        <div class="todo-list">
          <ul id="task-list">
            <li>Task 1 | Est. Time | Est. Pomodoros</li>
            <li>Task 2 | Est. Time | Est. Pomodoros</li>
          </ul>
          <div id="task-addition">
            <!-- Here is where tasks will be added -->
            <input type="text" name="task-name" placeholder="Task Name">
            <input type="text" name="task-est-time" placeholder="Est. Time">
            <button>Add</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function convert_seconds(seconds) {
      const minutes = Math.floor(seconds / 60);
      const remaining = seconds % 60;
      return minutes + ":" + remaining.toString().padStart(2, '0');
    }

    class Timer {
      constructor(seconds, display_dom) {
        this.seconds = seconds;
        this.state = "Stopped";
        this.current = this.seconds;
        this.starttime = null;
        this.elapsed = 0;
        this.timer_loop = null;
        this.sync_counter = 0;
        this.display_dom = display_dom;
      }

      startTimer() {
        if (this.state === "Running") return; // disable for multiple clicks
        this.state = "Running";
        this.starttime = new Date().getTime();

        this.timer_loop = setInterval((timer) => {
          if (timer.sync_counter % 10 === 0) {
            timer.timerSync();
            timer.sync_counter = 0;
          } else {
            timer.countDown();
          }
          timer.sync_counter++;
        }, 1000, this);
      }

      pauseTimer() {
        // To be implemented
      }

      countDown() {
        this.current -= 1;
        this.display_dom.innerText = convert_seconds(this.current);
        this.finished();
      }

      timerSync() {
        const elapsed = new Date().getTime() - this.starttime;
        this.elapsed = Math.floor(elapsed / 1000);
        this.current = this.seconds - this.elapsed;
        this.display_dom.innerText = convert_seconds(this.current);
        this.finished();
      }

      finished() {
        if (this.current > 0) return;

        clearInterval(this.timer_loop);
        this.state = "Stopped";
        console.log("Timer finished.");
        document.getElementById('start-btn').disabled = false;
      }
    }

    let ptimer = null;
    const timer_display = document.getElementById('timer-counter');
    let seconds = 5 * 60;

   
    function start_timer() {
      if (ptimer && ptimer.state === "Running") return;

      const select_value = document.getElementById('timer-select').value;
      if (select_value === "custom") {
        // Prompting the user for a custom time
        const custom = prompt("Enter custom time in minutes:");
        seconds = parseInt(custom || "5") * 60;
      } else {
        seconds = parseInt(select_value) * 60;
      }

      ptimer = new Timer(seconds, timer_display);
      ptimer.startTimer();

      document.getElementById('start-btn').disabled = true; // grey out button after one press, to be refreshed after pause or reset. 
    }
  </script>
</body>
</html>
